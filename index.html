<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>AnaLingo ðŸŽµ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; background: linear-gradient(135deg,#f5f0ff,#ffe5f0); display:flex; flex-direction:column; align-items:center; padding:40px; }
h1 { color:#7e1389; text-align:center; margin-bottom:20px; }
p.description { color:#333; font-size:1.1rem; text-align:center; margin-bottom:40px; }
#assignForm, #adminForm { background:#fff; padding:20px 30px; border-radius:15px; margin-bottom:20px; display:flex; flex-direction:column; align-items:center; gap:10px; }
input { padding:10px; font-size:16px; border:1px solid #ccc; border-radius:6px; width:220px; }
button { padding:10px 20px; font-size:16px; border:none; border-radius:6px; background:#7e1389; color:#fff; cursor:pointer; }
button:hover { background:#38063f; }
#result, #adminResult { margin-top:10px; min-height:1.2em; text-align:center; font-weight:600; }
#result.assigned { color:#007700; }
#result.error { color:#7e1389; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; }
th { background-color: #f2e5ff; color: #7e1389; }
</style>
</head>
<body>

<h1>AnaLingo â–¶ dodela jezika ðŸŽµðŸŽ§</h1>
<p class="description">Unesi svoj nick sa foruma i dobiÄ‡eÅ¡ jezik svog predloga za AnaLingo!ðŸ”®</p>

<!-- USER -->
<div id="assignForm">
  <input type="text" id="username" placeholder="Unesi svoj nick ðŸ’œ">
  <button onclick="assignLanguage()">Dodeli jezik</button>
  <div id="result"></div>
</div>

<!-- ADMIN -->
<div id="adminForm">
  <input type="password" id="adminPassword" placeholder="Admin lozinka ðŸ”’">
  <button onclick="loadAdmin()">PrikaÅ¾i sve dodele</button>
  <button onclick="resetLanguages()">Resetuj jezike</button>
  <div id="adminResult"></div>
</div>

<script>
const BASE_URL = "https://script.google.com/macros/s/AKfycbzaHPrmU_69SbxxYaMDG2mSYGShXmy1X0LzslYaDV5NvqMHQBeDf42UZY5ROsRpppaOTw/exec";

// USER
function assignLanguage(){
  const username = document.getElementById("username").value.trim();
  const result = document.getElementById("result");
  if(!username){ result.textContent="Unesi nick ðŸ’œ"; result.className="error"; return; }
  result.textContent="Loading..."; result.className="";
  const cb = "cb_"+Date.now()+"_"+Math.floor(Math.random()*1000);
  window[cb] = function(data){
    if(data.error){ result.textContent=data.error; result.className="error"; }
    else if(data.assigned && data.message){ result.textContent=data.message; result.className="assigned"; }
    else{ result.textContent="Dodeljen ti je jezik: "+data.assigned; result.className="assigned"; }
    delete window[cb];
  };
  const s = document.createElement("script");
  s.src = BASE_URL+"?username="+encodeURIComponent(username)+"&callback="+cb;
  document.body.appendChild(s);
}

// ADMIN
function loadAdmin(){
  const pw = document.getElementById("adminPassword").value.trim();
  const adminResult = document.getElementById("adminResult");
  if(!pw){ adminResult.textContent="Unesi lozinku ðŸ’œ"; return; }
  adminResult.textContent="Loading...";
  const cb = "cb_"+Date.now()+"_"+Math.floor(Math.random()*1000);
  window[cb] = function(data){
    if(data.error){ adminResult.textContent=data.error; }
    else{
      let html = "<h3>Dodeljeni jezici:</h3>";
      html += "<table><tr><th>Korisnik</th><th>Jezik</th></tr>";
      for(const [user, lang] of Object.entries(data.assigned)){
        html += `<tr><td>${user}</td><td>${lang}</td></tr>`;
      }
      html += "</table>";

      html += "<h3>Preostali jezici:</h3>";
      html += "<table><tr><th>Jezik</th><th>Preostalo</th></tr>";
      for(const [lang, count] of Object.entries(data.languages)){
        html += `<tr><td>${lang}</td><td>${count}</td></tr>`;
      }
      html += "</table>";

      adminResult.innerHTML = html || "JoÅ¡ niko nije dobio jezik ðŸ’œ";
    }
    delete window[cb];
  };
  const s = document.createElement("script");
  s.src = BASE_URL+"?admin=true&adminPassword="+encodeURIComponent(pw)+"&callback="+cb;
  document.body.appendChild(s);
}

function resetLanguages(){
  const pw = document.getElementById("adminPassword").value.trim();
  if(!pw){ alert("Unesi lozinku"); return; }
  const cb = "cb_"+Date.now()+"_"+Math.floor(Math.random()*1000);
  window[cb] = function(data){
    if(data.error){ alert(data.error); }
    else{ alert(data.message || "Jezici su resetovani ðŸ’œ"); loadAdmin(); }
    delete window[cb];
  };
  const s = document.createElement("script");
  s.src = BASE_URL+"?reset=true&admin=true&adminPassword="+encodeURIComponent(pw)+"&callback="+cb;
  document.body.appendChild(s);
}
</script>

</body>
</html>
