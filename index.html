<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>AnaLingo üéµ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg,#f5f0ff,#ffe5f0); display:flex; flex-direction:column; align-items:center; justify-content:start; min-height:100vh; margin:0; padding:60px 20px; }
h1 { color:#7e1389; font-size:2.5rem; text-align:center; margin-bottom:30px; }
p.description { color:#333; font-size:1.1rem; text-align:center; margin-bottom:40px; }
#assignForm { background:#fff; padding:30px 40px; border-radius:15px; display:flex; flex-direction:column; gap:15px; align-items:center; }
#assignForm input { padding:12px; font-size:18px; width:250px; border:1px solid #ccc; border-radius:8px; outline:none; }
#assignForm input:focus { border-color:#7e1389; }
#assignForm button { padding:12px 30px; font-size:18px; background-color:#7e1389; color:white; border:none; border-radius:8px; cursor:pointer; }
#assignForm button:hover { background-color:#38063f; }
#result { margin-top:20px; font-size:1.3rem; font-weight:600; color:#333; min-height:1.5em; text-align:center; }
#result.assigned { color:#007700; }
#result.error { color:#7e1389; }
.loader { border:4px solid #f3f3f3; border-radius:50%; border-top:4px solid #7e1389; width:20px; height:20px; animation:spin 1s linear infinite; display:inline-block; margin-left:10px; vertical-align:middle; }
@keyframes spin { 0% { transform:rotate(0deg);} 100% { transform:rotate(360deg);} }
</style>
</head>
<body>

<h1>AnaLingo ‚ñ∂ dodela jezika üéµüéß</h1>
<p class="description">Unesi svoj nick sa foruma i dobiƒáe≈° jezik svog predloga za AnaLingo!üîÆ</p>

<div id="assignForm">
  <input type="text" id="username" placeholder="Unesi svoj nick üíú">
  <button onclick="assignLanguage()">Dodeli jezik</button>
</div>

<p id="result"></p>

<script>
let lastUsername = "";

function assignLanguage(attempt = 1) {
  const username = document.getElementById("username").value.trim();
  const result = document.getElementById("result");
  const btn = document.querySelector("#assignForm button");

  if (!username) {
    result.textContent = "Unesi nick üíú";
    result.className = "error";
    return;
  }

  if (username === lastUsername) {
    result.textContent = "Saƒçekaj trenutak ‚è≥";
    result.className = "error";
    return;
  }

  lastUsername = username;
  btn.disabled = true;

  result.innerHTML = (attempt === 1)
    ? 'Loading <span class="loader"></span>'
    : 'Poku≈°avam ponovo... (' + attempt + '/3) <span class="loader"></span>';
  result.className = "";

  const cbName = "cb_" + Date.now() + "_" + Math.floor(Math.random()*1000);
  window[cbName] = function(data) {
    cleanup();
    if (data.error) {
      result.textContent = data.error;
      result.className = "error";
    } else if (data.message) {
      result.textContent = data.message;
      result.className = "assigned";
    } else {
      result.textContent = "Dodeljen ti je jezik: " + data.assigned;
      result.className = "assigned";
    }
  };

  const scriptEl = document.createElement("script");
  const base = "https://script.google.com/macros/s/AKfycbymoRVfrONRAqmG03cx7KzDrg7zw-3UXhFZHYcXGdCvakXBuaqk2OlgZwPWCZuSBh5nSA/exec"; // 
  scriptEl.src = base + "?username=" + encodeURIComponent(username) + "&callback=" + cbName;

  scriptEl.onerror = function() {
    cleanup();
    if (attempt < 3) assignLanguage(attempt + 1);
    else {
      result.textContent = "Gre≈°ka u komunikaciji sa serverom.";
      result.className = "error";
    }
  };

  function cleanup() {
    setTimeout(() => {
      btn.disabled = false;
      if (scriptEl && scriptEl.parentNode) scriptEl.parentNode.removeChild(scriptEl);
      try { delete window[cbName]; } catch(e){ window[cbName] = undefined; }
    }, 50);
  }

  document.body.appendChild(scriptEl);
}
</script>

</body>
</html>


